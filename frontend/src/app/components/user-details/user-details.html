<div class="user-list-wrapper" [class.panel-open]="showUserPanel">
    <!-- Main Content Area -->
    <div class="user-list-content">
        <!-- Header -->
        <div class="page-header">
            <div class="header-left">
                <h4 class="page-title">User List</h4>
                <span class="user-count">({{ count }} users)</span>
            </div>
            <div class="header-actions">
                <div class="view-toggle-compact">
                    <button class="toggle-icon" [class.active]="viewMode === 'list'" (click)="viewMode = 'list'" title="List View">
                        <i class="fas fa-list"></i>
                    </button>
                    <button class="toggle-icon" [class.active]="viewMode === 'card'" (click)="viewMode = 'card'" title="Card View">
                        <i class="fas fa-th-large"></i>
                    </button>
                </div>
                <button class="btn-add-user" (click)="openAddUserPage()">
                    <i class="fas fa-plus"></i>
                    <span>Add User</span>
                </button>
            </div>
        </div>

        <!-- Filter Bar -->
        <div class="filter-bar">
            <div class="filter-group">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search by name, email or UPN..." 
                           [(ngModel)]="searchTerm" (ngModelChange)="onSearchInput($event)">
                </div>
                <select class="filter-select-sm" [(ngModel)]="filterRole" (change)="applyFilters()">
                    <option value="">All Roles</option>
                    <option *ngFor="let role of roles" [value]="role.id">{{ role.name }}</option>
                </select>
                <select class="filter-select-sm" [(ngModel)]="filterStatus" (change)="applyFilters()">
                    <option value="">All Status</option>
                    <option value="1">Verified</option>
                    <option value="0">Pending</option>
                </select>
                <select class="filter-select-sm" [(ngModel)]="sortBy" (change)="applyFilters()">
                    <option value="">Sort by</option>
                    <option value="date_desc">Newest First</option>
                    <option value="date_asc">Oldest First</option>
                    <option value="name_asc">Name (A-Z)</option>
                    <option value="name_desc">Name (Z-A)</option>
                </select>
            </div>
            <button class="btn-clear-sm" *ngIf="filterRole || filterStatus || sortBy || searchTerm" (click)="clearFilters()">
                <i class="fas fa-times"></i> Clear
            </button>
        </div>

        <!-- Data Table (List View) -->
        <div class="data-table-wrapper" *ngIf="viewMode === 'list'">
            <table class="data-table">
                <thead>
                    <tr>
                        <th class="col-actions"></th>
                        <th class="col-user">User</th>
                        <th class="col-role">Role</th>
                        <th class="col-status">Status</th>
                        <th class="col-date">Created Date</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngIf="appUsers.length === 0">
                        <td colspan="5" class="empty-row">No users found.</td>
                    </tr>
                    <tr *ngFor="let user of appUsers" 
                        [class.selected]="selectedUserForRole?.userId === user.userId"
                        (click)="selectUser(user)">
                        <td>
                            <div class="action-icons">
                                <button class="icon-btn purple" title="View" (click)="$event.stopPropagation()">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="icon-btn orange" title="Edit" (click)="$event.stopPropagation(); selectUser(user)">
                                    <i class="fas fa-pencil-alt"></i>
                                </button>
                            </div>
                        </td>
                        <td>
                            <div class="table-user-info">
                                <span class="table-user-name" [title]="user.username || user.email">{{ user.username || user.email.split('@')[0] }}</span>
                                <span class="table-user-email" [title]="user.email">{{ user.email }}</span>
                            </div>
                        </td>
                        <td>
                            <span *ngFor="let role of user.roles" 
                                  class="role-badge"
                                  [class.admin]="role.roleName.toLowerCase() === 'admin'"
                                  [class.user]="role.roleName.toLowerCase() === 'user'"
                                  [class.moderator]="role.roleName.toLowerCase() === 'moderator'"
                                  [class.tester]="role.roleName.toLowerCase() === 'tester'">
                                {{ role.roleName }}
                            </span>
                        </td>
                        <td>
                            <span class="status-badge" [class.verified]="user.active !== 0" [class.pending]="user.active === 0">
                                <i class="fas" [class.fa-check-circle]="user.active !== 0" [class.fa-clock]="user.active === 0"></i>
                                {{ user.active !== 0 ? 'Verified' : 'Pending' }}
                            </span>
                        </td>
                        <td class="date-cell">{{ user.createdDateTime | date:'dd MMM yyyy' }}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Card View -->
        <div *ngIf="viewMode === 'card'">
            <div class="empty-state" *ngIf="appUsers.length === 0">
                <i class="fas fa-users"></i>
                <p>No users found.</p>
            </div>
            <div class="card-grid" *ngIf="appUsers.length > 0">
                <div class="user-card" *ngFor="let user of appUsers"
                     [class.selected]="selectedUserForRole?.userId === user.userId"
                     (click)="selectUser(user)">
                    <div class="card-header">
                        <div class="card-user-info">
                            <div class="card-user-name" [title]="user.username || user.email">{{ user.username || user.email.split('@')[0] }}</div>
                            <div class="card-user-email" [title]="user.email">{{ user.email }}</div>
                        </div>
                        <div class="card-actions">
                            <button class="icon-btn purple" title="View" (click)="$event.stopPropagation()">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="icon-btn orange" title="Edit" (click)="$event.stopPropagation(); selectUser(user)">
                                <i class="fas fa-pencil-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <span *ngFor="let role of user.roles" 
                              class="role-badge"
                              [class.admin]="role.roleName.toLowerCase() === 'admin'"
                              [class.user]="role.roleName.toLowerCase() === 'user'"
                              [class.moderator]="role.roleName.toLowerCase() === 'moderator'"
                              [class.tester]="role.roleName.toLowerCase() === 'tester'">
                            {{ role.roleName }}
                        </span>
                        <span class="status-badge" [class.verified]="user.active !== 0" [class.pending]="user.active === 0">
                            <i class="fas" [class.fa-check-circle]="user.active !== 0" [class.fa-clock]="user.active === 0"></i>
                            {{ user.active !== 0 ? 'Verified' : 'Pending' }}
                        </span>
                    </div>
                    <div class="card-footer">
                        <span class="card-date">
                            <i class="fas fa-calendar-alt"></i>
                            {{ user.createdDateTime | date:'dd MMM yyyy' }}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pagination -->
        <div class="pagination-wrapper">
            <app-pagination 
                [totalCount]="count" 
                [pageSize]="pageSize" 
                [currentPage]="currentPage" 
                (pageChange)="onPageChange($event)">
            </app-pagination>
        </div>
    </div>

    <!-- Slide-out Panel -->
    <div class="user-panel" [class.open]="showUserPanel">
        <!-- Edit User Panel -->
        <div class="panel-inner" *ngIf="selectedUserForRole">
            <!-- Panel Header -->
            <div class="panel-header">
                <h5 class="panel-title">{{ selectedUserForRole.username || selectedUserForRole.email.split('@')[0] }}</h5>
                <div class="panel-actions">
                    <button class="icon-btn-sm close-btn" title="Close" (click)="closePanel()"><i class="fas fa-times"></i></button>
                </div>
            </div>

            <!-- Panel Body -->
            <div class="panel-body">
                <h6 class="section-title">ACCESS INFORMATION</h6>

                <!-- Role -->
                <div class="panel-form-group">
                    <label class="panel-form-label">Role <span class="required">*</span></label>
                    <div class="radio-group">
                        <label *ngFor="let role of roles" class="radio-item">
                            <input type="radio" name="panelRole" [value]="role.id" [(ngModel)]="selectedNewRoleId">
                            <span class="radio-label">{{ role.name | titlecase }}</span>
                        </label>
                    </div>
                </div>

                <!-- Status -->
                <div class="panel-form-group">
                    <label class="panel-form-label">Status</label>
                    <div class="radio-group">
                        <label class="radio-item">
                            <input type="radio" name="panelStatus" [value]="1" [(ngModel)]="selectedNewStatus">
                            <span class="radio-label">Verified</span>
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="panelStatus" [value]="0" [(ngModel)]="selectedNewStatus">
                            <span class="radio-label">Pending</span>
                        </label>
                    </div>
                </div>

                <h6 class="section-title mt-4">USER DETAILS</h6>

                <!-- Email -->
                <div class="panel-form-group">
                    <label class="panel-form-label">Email</label>
                    <input type="text" class="panel-form-input readonly" [value]="selectedUserForRole.email" readonly>
                </div>

                <!-- Username -->
                <div class="panel-form-group">
                    <label class="panel-form-label">Username</label>
                    <input type="text" class="panel-form-input readonly" [value]="selectedUserForRole.username" readonly>
                </div>

                <!-- UPN -->
                <div class="panel-form-group">
                    <label class="panel-form-label">UPN</label>
                    <input type="text" class="panel-form-input readonly" [value]="selectedUserForRole.upn" readonly>
                </div>

                <!-- Created Date -->
                <div class="panel-form-group">
                    <label class="panel-form-label">Created Date</label>
                    <input type="text" class="panel-form-input readonly" 
                           [value]="selectedUserForRole.createdDateTime | date:'dd MMM yyyy, hh:mm a'" readonly>
                </div>


            </div>

            <!-- Panel Footer -->
            <div class="panel-footer">
                <button class="btn-panel-cancel" (click)="closePanel()">Cancel</button>
                <button class="btn-panel-update" (click)="onClickUpdateRole()">Update</button>
            </div>
        </div>
    </div>
</div>

<!-- Backdrop -->
<div class="panel-backdrop" [class.visible]="showUserPanel" (click)="closePanel()"></div>
